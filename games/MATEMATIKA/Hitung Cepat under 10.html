<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Math Quiz - Penjumlahan Dasar</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        .shake {
            animation: shake 0.2s ease-in-out 0s 2;
        }
        .timer-bar {
            transition: width 0.1s linear, background-color 0.3s ease;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body class="bg-slate-100 min-h-screen flex items-center justify-center p-4 font-sans text-slate-800">

    <!-- Container Utama -->
    <div id="game-container" class="bg-white p-8 rounded-2xl shadow-xl w-full max-w-md transition-all duration-300">
        
        <!-- Layar Mulai -->
        <div id="start-screen" class="text-center">
            <h1 class="text-3xl font-bold mb-6 text-indigo-600">Kuis Matematika</h1>
            <p class="text-slate-600 mb-8">Selesaikan 15 soal penjumlahan dengan hasil maksimal 10.</p>
            
            <div class="mb-8">
                <label for="timer-setting" class="block text-sm font-medium text-slate-700 mb-2">
                    Atur Waktu Per Soal (detik): <span id="timer-val" class="font-bold text-indigo-600">5</span>s
                </label>
                <input type="range" id="timer-setting" min="2" max="10" value="5" 
                    class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-indigo-600">
            </div>

            <button id="start-btn" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 rounded-xl shadow-lg transition transform hover:scale-105 active:scale-95">
                MULAI KUIS
            </button>
        </div>

        <!-- Layar Kuis -->
        <div id="quiz-screen" class="hidden">
            <!-- Header Kuis -->
            <div class="flex justify-between items-center mb-6">
                <span class="text-sm font-semibold text-slate-400">Soal <span id="current-idx">1</span> / 15</span>
                <span class="text-sm font-semibold text-indigo-500">Skor: <span id="live-score">0</span></span>
            </div>

            <!-- Timer Visual -->
            <div class="w-full bg-slate-200 h-3 rounded-full mb-2 overflow-hidden">
                <div id="timer-progress" class="timer-bar h-full bg-green-500 w-full"></div>
            </div>
            <div id="timer-text" class="text-center font-mono font-bold text-lg mb-6">0.0s</div>

            <!-- Area Soal -->
            <div id="question-area" class="text-center mb-8">
                <div id="equation" class="text-5xl font-black text-slate-800 tracking-tighter">5 + 3 = ?</div>
                <div id="feedback-text" class="h-8 mt-4 font-bold text-xl"></div>
            </div>

            <!-- Pilihan Jawaban -->
            <div id="options-grid" class="grid grid-cols-2 gap-4">
                <!-- Tombol akan di-generate via JS -->
            </div>
        </div>

        <!-- Layar Hasil (Sesuai Spesifikasi id="result-screen") -->
        <div id="result-screen" class="hidden text-center">
            <div class="text-6xl mb-4">üèÜ</div>
            <h2 class="text-2xl font-bold mb-2">Kuis Selesai!</h2>
            <p class="text-slate-500 mb-6">Skor akhir Anda adalah:</p>
            
            <div class="bg-indigo-50 rounded-2xl p-8 mb-8">
                <!-- id="final-score" sesuai spesifikasi -->
                <div id="final-score" class="text-7xl font-black text-indigo-600 leading-none">0</div>
                <div class="text-indigo-300 font-bold mt-2 text-xl">/ 100</div>
            </div>

            <button onclick="location.reload()" class="w-full bg-slate-800 hover:bg-black text-white font-bold py-4 rounded-xl transition">
                COBA LAGI
            </button>
        </div>
    </div>

    <script>
        // State Global
        let timerLimit = 5;
        let currentQuestion = 1;
        let score = 0;
        let correctAnswers = 0;
        let totalQuestions = 15;
        let timeLeft = 0;
        let timerInterval = null;
        let canAnswer = true;
        let currentCorrectResult = 0;

        // Element Selectors
        const startScreen = document.getElementById('start-screen');
        const quizScreen = document.getElementById('quiz-screen');
        const resultScreen = document.getElementById('result-screen');
        const finalScoreEl = document.getElementById('final-score');
        const startBtn = document.getElementById('start-btn');
        const timerInput = document.getElementById('timer-setting');
        const timerValDisplay = document.getElementById('timer-val');
        const equationEl = document.getElementById('equation');
        const optionsGrid = document.getElementById('options-grid');
        const timerProgress = document.getElementById('timer-progress');
        const timerText = document.getElementById('timer-text');
        const feedbackText = document.getElementById('feedback-text');
        const currentIdxEl = document.getElementById('current-idx');
        const liveScoreEl = document.getElementById('live-score');
        const gameContainer = document.getElementById('game-container');

        // Update display timer setting
        timerInput.addEventListener('input', (e) => {
            timerLimit = parseInt(e.target.value);
            timerValDisplay.textContent = timerLimit;
        });

        startBtn.addEventListener('click', startQuiz);

        function startQuiz() {
            startScreen.classList.add('hidden');
            quizScreen.classList.remove('hidden');
            loadQuestion();
        }

        function generateQuestion() {
            // A + B <= 10
            const result = Math.floor(Math.random() * 11); // 0 sampai 10
            const a = Math.floor(Math.random() * (result + 1));
            const b = result - a;
            
            currentCorrectResult = result;

            // Generate distractors
            let options = new Set();
            options.add(result);
            while(options.size < 4) {
                let distractor = Math.floor(Math.random() * 11);
                options.add(distractor);
            }

            return {
                equation: `${a} + ${b} = ?`,
                correct: result,
                choices: Array.from(options).sort(() => Math.random() - 0.5)
            };
        }

        function loadQuestion() {
            if (currentQuestion > totalQuestions) {
                showResult();
                return;
            }

            canAnswer = true;
            feedbackText.textContent = "";
            currentIdxEl.textContent = currentQuestion;
            
            const q = generateQuestion();
            equationEl.textContent = q.equation;
            
            // Render buttons
            optionsGrid.innerHTML = '';
            q.choices.forEach(choice => {
                const btn = document.createElement('button');
                btn.textContent = choice;
                btn.className = "bg-white border-2 border-slate-200 hover:border-indigo-400 py-4 rounded-xl text-2xl font-bold transition-all duration-200 active:scale-95";
                btn.onclick = () => handleAnswer(choice, btn);
                optionsGrid.appendChild(btn);
            });

            startTimer();
        }

        function startTimer() {
            clearInterval(timerInterval);
            timeLeft = timerLimit;
            updateTimerUI();

            const intervalMs = 100;
            timerInterval = setInterval(() => {
                timeLeft -= intervalMs / 1000;
                if (timeLeft <= 0) {
                    timeLeft = 0;
                    clearInterval(timerInterval);
                    handleAnswer(null); // Time out
                }
                updateTimerUI();
            }, intervalMs);
        }

        function updateTimerUI() {
            const percentage = (timeLeft / timerLimit) * 100;
            timerProgress.style.width = `${percentage}%`;
            timerText.textContent = `${timeLeft.toFixed(1)}s`;

            // Change color to red if low
            if (timeLeft < 2) {
                timerProgress.classList.remove('bg-green-500');
                timerProgress.classList.add('bg-red-500');
                timerText.classList.add('text-red-500');
            } else {
                timerProgress.classList.add('bg-green-500');
                timerProgress.classList.remove('bg-red-500');
                timerText.classList.remove('text-red-500');
            }
        }

        function handleAnswer(selected, btn = null) {
            if (!canAnswer) return;
            canAnswer = false;
            clearInterval(timerInterval);

            const buttons = optionsGrid.querySelectorAll('button');

            if (selected === currentCorrectResult) {
                // BENAR
                correctAnswers++;
                liveScoreEl.textContent = correctAnswers;
                feedbackText.textContent = "BENAR! ‚úì";
                feedbackText.className = "h-8 mt-4 font-bold text-2xl text-green-500";
                if (btn) btn.classList.add('bg-green-500', 'text-white', 'border-green-600');
            } else {
                // SALAH ATAU TIMEOUT
                gameContainer.classList.add('shake');
                setTimeout(() => gameContainer.classList.remove('shake'), 400);

                feedbackText.textContent = selected === null ? "WAKTU HABIS!" : "SALAH! ‚úó";
                feedbackText.className = "h-8 mt-4 font-bold text-2xl text-red-500";

                if (btn) btn.classList.add('bg-red-500', 'text-white', 'border-red-600');
                
                // Highlight correct answer
                buttons.forEach(b => {
                    if (parseInt(b.textContent) === currentCorrectResult) {
                        b.classList.add('bg-green-100', 'border-green-500', 'text-green-700');
                    }
                });
            }

            // Next question after delay
            setTimeout(() => {
                currentQuestion++;
                loadQuestion();
            }, 1200);
        }

        function showResult() {
            quizScreen.classList.add('hidden');
            resultScreen.classList.remove('hidden');
            
            // Formula: (Correct / 15 * 100) dibulatkan
            const scorePercent = Math.round((correctAnswers / totalQuestions) * 100);
            finalScoreEl.textContent = scorePercent;
        }
    </script>
</body>
</html>
